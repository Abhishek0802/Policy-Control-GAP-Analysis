<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Interpreter Review</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 30px; max-width: 1000px; line-height: 1.6; color: #333; }
    
    .metadata-section { background: #f8f9fa; border-left: 5px solid #007bff; padding: 20px; margin-bottom: 30px; border-radius: 4px; }
    
    .clause-box { border: 1px solid #eee; padding: 15px; margin-bottom: 15px; border-radius: 8px; display: flex; align-items: center; gap: 15px; transition: 0.2s; }
    .clause-box:hover { border-color: #007bff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    
    .clause-content { flex-grow: 1; }
    .section-ref { color: #888; font-size: 0.85rem; margin-bottom: 3px; display: block; }
    
    /* Container for the badges on the right */
    .status-group { display: flex; align-items: center; gap: 10px; min-width: fit-content; }

    .theme-badge { 
        background: #e7f3ff; color: #007bff; padding: 6px 12px; border-radius: 6px; 
        font-size: 0.8rem; font-weight: bold; text-transform: uppercase; white-space: nowrap; 
        border: 1px solid #cce5ff;
    }

    /* Confidence Box Styling */
    .confidence-box {
        padding: 6px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: bold;
        color: white; min-width: 55px; text-align: center; white-space: nowrap;
    }

    /* Color Ranks based on your Prompt Logic */
    .rank-high { background-color: #28a745; }    /* Green: 0.8 - 1.0 */
    .rank-mid  { background-color: #ffc107; color: #333; } /* Yellow: 0.6 - 0.8 */
    .rank-low  { background-color: #fd7e14; }    /* Orange: 0.4 - 0.6 */
    .rank-crit { background-color: #dc3545; }    /* Red: < 0.4 */

    button { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 1rem; margin-top: 20px; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>

<h2>Policy Interpreter Results</h2>

<div class="metadata-section">
    <h3>Document Information</h3>
    <p><strong>Title:</strong> {{ metadata.title }}</p>
    <p><strong>Owner:</strong> {{ metadata.owner }}</p>
    <p><strong>Effective Date:</strong> {{ metadata.effective_date }}</p>
    <p><strong>Applies To:</strong> {{ metadata.applies_to }}</p>
</div>

<p>Review the identified clauses. High-confidence items are marked in green. Please manually verify any orange or red items.</p>

<form method="post" action="/review/submit">

{% for item in analysis %}
  <div class="clause-box">
    <input type="checkbox" name="approved_clauses" value="{{ item.exact_clause }}" checked>
    
    <div class="clause-content">
        <span class="section-ref">{{ item.section_reference }}</span>
        <strong>{{ item.exact_clause }}</strong>
    </div>

    <div class="status-group">
        <div class="theme-badge">
            {{ item.theme }}
        </div>

        {# Logic for dynamic color coding based on the prompt ranges #}
        {% set score = item.confidence_score | float %}
        {% if score >= 0.8 %}
            {% set color_class = 'rank-high' %}
        {% elif score >= 0.6 %}
            {% set color_class = 'rank-mid' %}
        {% elif score >= 0.4 %}
            {% set color_class = 'rank-low' %}
        {% else %}
            {% set color_class = 'rank-crit' %}
        {% endif %}

        <div class="confidence-box {{ color_class }}">
            {{ (score * 100) | int }}%
        </div>
    </div>
  </div>
{% endfor %}

<button type="submit">Proceed to Final Analysis</button>

</form>
</body>
</html>